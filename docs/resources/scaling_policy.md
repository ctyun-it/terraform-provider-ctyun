# ctyun_scaling_policy (Resource)
-> 详细说明请见文档：https://www.ctyun.cn/document/10027725/10241454



## Example

```terraform
terraform {
  required_providers {
    ctyun = {
      source = "ctyun-it/ctyun"
    }
  }
}

# 可参考index.md，在环境变量中配置ak、sk、资源池ID、可用区名称
provider "ctyun" {
  env = "prod"
}


variable "key_pair" {
  type      = string
  sensitive = true
}

resource "ctyun_vpc" "vpc_test" {
  name        = "tf-vpc-for-scaling"
  cidr        = "192.168.0.0/16"
  description = "terraform-kafka测试使用"
  enable_ipv6 = true
}

resource "ctyun_subnet" "subnet_test" {
  vpc_id      = ctyun_vpc.vpc_test.id
  name        = "tf-subnet-for-scaling"
  cidr        = "192.168.1.0/24"
  description = "terraform-scaling测试使用"
  dns = [
    "114.114.114.114",
    "8.8.8.8",
    "8.8.4.4"
  ]
}
resource "ctyun_security_group" "sg_test" {
  vpc_id      = ctyun_vpc.vpc_test.id
  name        = "tf-sg-for-scaling"
  description = "terraform-scaling测试使用"
  lifecycle {
    prevent_destroy = false
  }
}

data "ctyun_images" "image_test" {
  name       = "CentOS Linux 8.4"
  visibility = "public"
  page_no = 1
  page_size = 10
}

locals {
  image_id = data.ctyun_images.image_test.images[0].id
}

resource "ctyun_keypair" "scaling_test" {
  name       = "key-pair-scaling-test"
  public_key = var.key_pair
}

resource "ctyun_scaling_config" "config_test" {
  name            = "sc-for-policy"
  image_id        =  local.image_id
  flavor_name     = "s7.large.2"
  use_floatings   = "diable"
  login_mode      = "key_pair"
  key_pair_id     = ctyun_keypair.scaling_test.id
  monitor_service = true
  az_names        = ["cn-huadong1-jsnj1A-public-ctcloud"]
  volumes         = [{"volume_type":"SATA", "volume_size": 40, "flag":"OS"}]
}


resource "ctyun_scaling_group" "group_test" {
  security_group_id_list = [ctyun_security_group.sg_test.id]
  name                   = "scaling-group-for-policy"
  health_mode            = "server"
  subnet_id_list         = [ctyun_subnet.subnet_test.id]
  move_out_strategy      = "earlier_config"
  vpc_id                 = ctyun_vpc.vpc_test.id
  min_count              = 1
  max_count              = 3
  health_period          = 300
  use_lb                 = 2
  config_list            = [ctyun_scaling_config.config_test.id]
  az_strategy            = "uniform_distribution"
  delete_protection      = "disable"
}

# 告警策略
resource "ctyun_scaling_policy" "policy_alert_example" {
  group_id                    = ctyun_security_group.sg_test.id
  name                        = "alert-policy-example"
  policy_type                 = "alert"
  operate_unit                = "percent"
  operate_count               = 10
  action                      = "increase"
  cooldown                    = 300
  trigger_name                = "cpu-high-alert"
  trigger_metric_name         = "cpu_util"
  trigger_statistics          = "avg"
  trigger_comparison_operator = "ge"
  trigger_threshold           = 80
  trigger_period              = "5m"
  trigger_evaluation_count    = 3
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `group_id` (Number) 伸缩组ID
- `name` (String) 伸缩策略名称，当status=disable时，支持更新
- `policy_type` (String) 策略类型: alert-告警策略, regular-定时策略, period-周期策略, target-目标追踪策略

### Optional

- `action` (String) 执行动作: increase-增加, decrease-减少, set-设置为，当status=disable时，支持更新
- `cooldown` (Number) 冷却/预热时间 (单位: 秒)，当status=disable时，支持更新
- `cycle` (String) 循环方式: monthly-按月循环, weekly-按周循环, daily-按天循环，当status=disable时，支持更新
- `day` (Set of Number) 执行日期，当cycle=monthly时，取值范围为[1,31]，担当cycle=weekly时，取值范围为[1,7]，当status=disable时，支持更新
- `effective_from` (String) 周期策略生效开始时间 (格式: 2006-01-02 15:04:05)，当status=disable时，支持更新
- `effective_till` (String) 周期策略生效截止时间 (格式: 2006-01-02 15:04:05)，当status=disable时，支持更新
- `execution_time` (String) 执行时间 (格式: 2006-01-02 15:04:05)，当status=disable时，支持更新
- `is_execute` (Boolean) 控制是否需要执行弹性伸缩策略，true表示执行，false表示不执行。默认为false，支持更新
- `operate_count` (Number) 调整值，当status=disable时，支持更新
- `operate_unit` (String) 操作单位: count-个数, percent-百分比，当status=disable时，支持更新
- `region_id` (String) 资源池ID
- `status` (String) 告警规则状态：enable：启用。disable：停用，支持更新
- `target_disable_scale_in` (Boolean) 是否禁用缩容，当status=disable时，支持更新。默认为false。
- `target_metric_name` (String) 监控指标名称，取值范围：cpu_util-CPU使用率，network_incoming_bytes_rate_inband-网络流入速率，network_outing_bytes_rate_inband-网络流出速率，当status=disable时，支持更新
- `target_operate_range` (Number) 缩容波动范围 (范围: 10-20)，，当status=disable时，支持更新
- `target_scale_in_evaluation_count` (Number) 缩容连续告警次数 (范围: 1-100)，当status=disable时，支持更新
- `target_scale_out_evaluation_count` (Number) 扩容连续告警次数 (范围: 1-100)，支持更新
- `target_value` (Number) 追踪目标值，当status=disable时，支持更新
- `trigger_comparison_operator` (String) 比较符: ge-大于等于, le-小于等于, gt-大于, lt-小于，当status=disable时，支持更新
- `trigger_evaluation_count` (Number) 连续出现次数，当status=disable时，支持更新
- `trigger_metric_name` (String) 监控指标名称，取值范围：cpu_util-CPU使用率，mem_util-内存使用率，network_incoming_bytes_rate_inband-网络流入速率，network_outing_bytes_rate_inband-网络流出速率，disk_read_bytes_rate-磁盘读速率，disk_write_bytes_rate-磁盘写速率，disk_read_requests_rate-磁盘读请求速率，disk_write_requests_rate-磁盘写请求速率，当status=disable时，支持更新
- `trigger_name` (String) 告警规则名称，当status=disable时，支持更新
- `trigger_period` (String) 监控周期 (如: 5m)，当status=disable时，支持更新
- `trigger_statistics` (String) 聚合方法: avg-平均值, max-最大值, min-最小值，当status=disable时，支持更新
- `trigger_threshold` (Number) 阈值，当status=disable时，支持更新

### Read-Only

- `id` (Number) 伸缩策略id